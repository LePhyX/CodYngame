import java.io.*;
import java.nio.file.*;
import java.util.*;

/**
 * Programme permettant de fusionner deux codes source.
 */
public class FusionneurCode {
    
    /**
     * Fusionne un code de base avec un code à ajouter.
     * 
     * @param codeBase Le code source de base
     * @param codeAjout Le code source à ajouter
     * @param position Où ajouter le nouveau code ("debut", "fin", ou "ligne:N")
     * @return Le code fusionné
     */
    public static String fusionnerCodes(String codeBase, String codeAjout, String position) {
        if (position.equals("debut")) {
            return codeAjout + "\n" + codeBase;
        } else if (position.equals("fin")) {
            return codeBase + "\n" + codeAjout;
        } else if (position.startsWith("ligne:")) {
            try {
                int numeroLigne = Integer.parseInt(position.substring(6));
                String[] lignes = codeBase.split("\n");
                
                // Vérifier si le numéro de ligne est valide
                if (numeroLigne < 0 || numeroLigne > lignes.length) {
                    return "Erreur: Le numéro de ligne " + numeroLigne + " est invalide.";
                }
                
                // Insérer le code à la ligne spécifiée
                StringBuilder resultat = new StringBuilder();
                for (int i = 0; i < lignes.length; i++) {
                    if (i == numeroLigne) {
                        resultat.append(codeAjout).append("\n");
                    }
                    resultat.append(lignes[i]).append("\n");
                }
                return resultat.toString();
            } catch (NumberFormatException e) {
                return "Erreur: Format de position incorrect. Utilisez 'ligne:N' où N est un nombre entier.";
            }
        } else {
            return "Erreur: Position non reconnue. Utilisez 'debut', 'fin', ou 'ligne:N'.";
        }
    }

    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        
        System.out.println("Programme de fusion de codes source");
        System.out.println("----------------------------------");
        
        // Option 1: Entrer le code directement
        System.out.print("Voulez-vous entrer le code directement (D) ou charger des fichiers (F)? ");
        String choix = scanner.nextLine().toUpperCase();
        
        String codeBase = "";
        String codeAjout = "";
        
        if (choix.equals("D")) {
            System.out.println("\nEntrez le code de base (terminez par une ligne contenant uniquement 'FIN'):");
            StringBuilder lignesBase = new StringBuilder();
            while (true) {
                String ligne = scanner.nextLine();
                if (ligne.equals("FIN")) {
                    break;
                }
                lignesBase.append(ligne).append("\n");
            }
            codeBase = lignesBase.toString();
            
            System.out.println("\nEntrez le code à ajouter (terminez par une ligne contenant uniquement 'FIN'):");
            StringBuilder lignesAjout = new StringBuilder();
            while (true) {
                String ligne = scanner.nextLine();
                if (ligne.equals("FIN")) {
                    break;
                }
                lignesAjout.append(ligne).append("\n");
            }
            codeAjout = lignesAjout.toString();
        } else if (choix.equals("F")) {
            System.out.print("\nNom du fichier de base: ");
            String fichierBase = scanner.nextLine();
            try {
                codeBase = new String(Files.readAllBytes(Paths.get(fichierBase)));
            } catch (IOException e) {
                System.out.println("Erreur: Impossible d'ouvrir " + fichierBase);
                System.exit(1);
            }
            
            System.out.print("Nom du fichier à ajouter: ");
            String fichierAjout = scanner.nextLine();
            try {
                codeAjout = new String(Files.readAllBytes(Paths.get(fichierAjout)));
            } catch (IOException e) {
                System.out.println("Erreur: Impossible d'ouvrir " + fichierAjout);
                System.exit(1);
            }
        } else {
            System.out.println("Choix non reconnu. Fin du programme.");
            System.exit(1);
        }
        
        // Choisir la position d'insertion
        System.out.println("\nOù voulez-vous insérer le code?");
        System.out.println("1. Au début du code de base");
        System.out.println("2. À la fin du code de base");
        System.out.println("3. À une ligne spécifique");
        System.out.print("Choisissez (1/2/3): ");
        String option = scanner.nextLine();
        
        String position;
        if (option.equals("1")) {
            position = "debut";
        } else if (option.equals("2")) {
            position = "fin";
        } else if (option.equals("3")) {
            System.out.print("Numéro de ligne: ");
            String numero = scanner.nextLine();
            position = "ligne:" + numero;
        } else {
            System.out.println("Option non reconnue. Utilisation de la fin par défaut.");
            position = "fin";
        }
        
        // Fusionner les codes
        String resultat = fusionnerCodes(codeBase, codeAjout, position);
        
        // Afficher le résultat
        System.out.println("\nCode fusionné:");
        System.out.println("--------------");
        System.out.println(resultat);
        
        // Option pour sauvegarder le résultat
        System.out.print("\nVoulez-vous sauvegarder le résultat (O/N)? ");
        if (scanner.nextLine().toUpperCase().equals("O")) {
            System.out.print("Nom du fichier de sortie: ");
            String fichierSortie = scanner.nextLine();
            try {
                Files.write(Paths.get(fichierSortie), resultat.getBytes());
                System.out.println("Code sauvegardé dans " + fichierSortie);
            } catch (IOException e) {
                System.out.println("Erreur: Impossible d'écrire dans " + fichierSortie);
            }
        }
        
        scanner.close();
    }
}
